I did the benchmark on energon1.cims.nyu.edu. Some analysis may depend on
the information about this machine. All the requests generated by httperf
request the lab4.txt file.


Time-break-down:

I use CPU profiler to analyze the time spent on each part of server. 
It turns out a large amount of time was spent on the operations of Buffer.
For example, the write, consume and readSize methods of Buffer class take 
a lot of time. So do the operations to buffer iterator.

It is normal because memory I/O is time consuming and operations of Buffer
are called so many times. (Every request parsing and handling is relevant 
with operations of Buffer.) 
 
Also, parseResponse method of Parser class and finishedRequest method of 
RequestStats class are main consumer of CPU time.


Bottleneck:

The first obvious bottleneck is the throughput of Net I/O, which can be
figured out in the httperf benchmark. The limit of Net I/O on energon1 is
about 9MB/s. When I increase the number of requests generated per second on 
this basis, neither Net I/O nor reply rate increases with it,
regardless I add more worker threads to the server. So the primary 
bottleneck of taking more requests per second is the limit of Net I/O.
The following results show the Net I/O as bottleneck:

num-worker  num-conn  rate  num-call  Net I/O(KB/s)  reply-rate
5           1000      200   400       8966.6         4687.7
20          1000      200   400       9621.0         4590.7
20          1000      200   800       7886.6         4149.2
25          1000      200   800       7489.1         3794.9


Making a connection to the server is relatively slow compared to fire a
request. So generating many connections but firing only a few requests
definitly decreases the throughput of server. However, connecting only a few
times and firing a lot of requests on each is not favorable, either. The 
following results show these two situations: (5 worker threads in server)

num-conn  rate  num-call  Net I/O(KB/s)  reply-rate
1         1     1000      81.6           42.5
2         1     500       150.7          79.2
4         1     250       216.8          116
5         1     200       223.7          123.2
10        1     100       172.2          93.2
50        1     20        38.8           20
100       1     10        19.3           10
200       1     5         9.6            5



